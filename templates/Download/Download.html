<!DOCTYPE html>
<html>

<head>
     <title>Download Data</title>
  <style>
    *{
      font-weight: 600;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
        input[type=datetime-local] {
        width: 300px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0px 0px 5px 0px #447b80;


    }
    .container {
        display: flex;
        justify-content: center;
        align-content: center;
        height: 80vh;
        padding-left: 50px;
        /* width: 5px; */
    }

    .form-container {
        border: 2px ;
        background-color: rgb(242, 242, 242);
        box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
        padding: 100px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        /* align-items: center; */
        place-items: center;
        margin: auto;
        margin-left: 30%;
        
        /* height: 400%; */
        gap: 10px;
        /* align-content: center; */
    }

    .download-link {
      display: inline-block;
      margin: 10px;
      padding: 10px;
      background-color: #4CAF50;
      color: white;
      text-decoration: none;
      animation: download-button-animation 2s infinite alternate;
    }

    @keyframes download-button-animation {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
      }
    }

    /* CSS for the table */
    #dataTable {
      border-collapse: collapse;
      width: 100%;
      margin: 0 auto;
      animation: table-fade-in 2s ease-in;
      /* align-items: center; */
    }
    .navbar {
  width: 100%;
  display: flex;
  margin: 0px auto 0 auto;
  justify-content: center;
  color: white;
  
}
.dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    .dropdown-content a {
      display: block;
      padding: 10px;
      text-decoration: none;
      color: white;
      background-color: black;
    }

    .dropdown-content a:hover {
      background-color: #ddd;
    }

    .dropdown-content ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    .dropdown-content .machine1 {
      color: white;
      font-weight: bold;
    }.menu {
  display: flex;
  justify-content: center;
}

.menu li {
  list-style: none;
  margin: 0 10px;
}

.menu a {
  color: white;
  font-size: 20px;
  font-weight: 500;
  text-decoration: none;
}

.menu a:hover {
  color: #000;
}

#main {
  height: 100%;
  width: 100%;
  background-image: url(Images/background.png);
  font-family: 'Lilita One', sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 30px;
}
    @keyframes table-fade-in {
      0% {
        opacity: 0;
      }
      100% {
        opacity: 1;
      }
    }

    /* CSS for the table rows */
    #dataTable tr {
      animation: table-row-fade-in 1s ease-in;
    }

    @keyframes table-row-fade-in {
      0% {
        opacity: 0;
      }
      100% {
        opacity: 1;
      }
    }

    /* CSS for the table cells */
    #dataTable td {
      border: 1px solid #ddd;
      padding: 8px;
      animation: table-cell-fade-in 0.5s ease-in;
    }

    @keyframes table-cell-fade-in {
      0% {
        opacity: 0;
      }
      100% {
        opacity: 1;
      }
    }
    select#machines {
            width: 200px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0px 0px 5px 0px #447b80;
        }
        .navbar{
          background-color: black;
        }
  </style>
</head>
<header>
  <nav> 
    <div class="navbar">
      <ul class="menu">
        <li class="dropdown">
          <a href="#"><b>‚öôÔ∏è Machine Status</b></a>
          <div class="dropdown-content">   
            <ul><a href="/cncprediction-modig" class="machine1"><b>Modig Machine</b></a></ul>
            <ul><a href="/cncprediction-jyoti" class="machine2"><b>Jyoti Machine</b></a></ul>
            <ul><a href="/cncprediction-dmg" class="machine3"><b>DMG Machine</b></a></ul>
            <ul><a href="/cncprediction-mazak" class="machine4"><b>Mazak Machine</b></a></ul>
          </div>
        </li>
        <li><a href="/pre"><b>üîÆ Prediction Engine</b></a></li>
        <li><a href="/cncprediction-zones"><b>üåê Zones and Limits</b></a></li>
        <li><a href="/cncprediction-download"><b>üì• Download Data</b></a></li>
        <li><a href="/cncprediction-faq"><b>‚ùì FAQ</b></a></li>
        <li><a id="logoutLink" href="#"><b>üö™ Log Out</b></a></li>
      </ul>
    </div>
  </nav>
</header>
<body>
    <div class="container">
        <div class="form-container">
            <label for="machines" style=font-size:20px>Machine:</label>
            <select id="machines"style=font-size:20px onchange="getData(this.value)">
            <option value="Machine0" style=font-size:20px>Select a Machine</option>
            <option value="Machine1" style=font-size:20px>Modig</option>
            <option value="Machine2" style=font-size:20px>Jyoti</option>
            <option value="Machine3" style=font-size:20px>DMG</option>
            <option value="Machine4" style=font-size:20px>Mazak</option>
            </select>&nbsp;
            <label for="startDate" style=font-size:20px><b>Start Date: </b></label>
            <input type="datetime-local" id="startDate" style=font-size:20px>
            &nbsp;
            <label for="endDate" style=font-size:20px><b>End Date:</b></label>
            <input type="datetime-local" id="endDate" style=font-size:20px>
            &nbsp;
            <a id="downloadLink" class="download-link" style=font-size:20px><b>Download File</b></a>
        </div>
        <table id="dataTable"></table>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script>
      let fileName="";
      function getData(selectedValue){
        console.log(selectedValue);
        
        if(selectedValue=="Machine1"){
          fileName="modig.csv"
        }
        else if(selectedValue=="Machine2"){
          fileName="CNC.csv";
        }
        else {
            fileName="";
        }
      }
        document.getElementById('downloadLink').addEventListener('click', function() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
   
            fetch(fileName)
                .then(response => response.text())
                .then(csvString => {
                    const data = Papa.parse(csvString, { header: true }).data;
                    const filteredData = data.filter(row => {
                        const date = new Date(row.Date);
                        return date >= startDate && date <= endDate;
                    });
   
                    const workbook = XLSX.utils.book_new();
                    const worksheet = XLSX.utils.json_to_sheet(filteredData);
                    XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');
   
                    const wbout = XLSX.write(workbook, { bookType: 'xlsx', type: 'binary' });
                    const blob = new Blob([s2ab(wbout)], { type: 'application/octet-stream' });
   
                    const link = document.getElementById('downloadLink');
                    link.href = URL.createObjectURL(blob);
                    link.download = 'data.xlsx';
 
                    // Display the filtered data in a table
                    const table = document.getElementById('dataTable');
                    table.innerHTML = '';
                    filteredData.forEach(row => {
                        const tr = document.createElement('tr');
                        Object.values(row).forEach(cell => {
                            const td = document.createElement('td');
                            td.textContent = cell;
                            tr.appendChild(td);
                        });
                        table.appendChild(tr);
                    });
                });
        });
   
        function s2ab(s) {
            const buf = new ArrayBuffer(s.length);
            const view = new Uint8Array(buf);
            for (let i = 0; i < s.length; i++) {
                view[i] = s.charCodeAt(i) & 0xFF;
            }
            return buf;
        }
    </script>
</body>
</html>